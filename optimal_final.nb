(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     28549,        608]
NotebookOptionsPosition[     28026,        585]
NotebookOutlinePosition[     28386,        601]
CellTagsIndexPosition[     28343,        598]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Mechanisms", "Title",
 CellChangeTimes->{{3.6986053895033712`*^9, 3.698605402450123*^9}}],

Cell[CellGroupData[{

Cell["Optimal Allocations", "Section",
 CellChangeTimes->{{3.6986054129507008`*^9, 3.698605415890473*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"generateFeasibilityConstraints", "[", "vm_", "]"}], " ", ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"And", " ", "@@", " ", 
     RowBox[{"Thread", "[", 
      RowBox[{
       RowBox[{"Plus", " ", "@@@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"Transpose", "[", "vm", "]"}], "]"}]}], " ", "\[LessEqual]", 
       " ", "1"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"generateNonZeroConstraints", "[", "vm_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"AllTrue", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "vm", "}"}], "]"}], ",", 
      RowBox[{
       RowBox[{"#", "\[GreaterEqual]", "0"}], " ", "&"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"generateCapacityConstraints", "[", 
     RowBox[{"vm_", ",", " ", "numtypes_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"And", " ", "@@", " ", 
     RowBox[{"Thread", "[", 
      RowBox[{
       RowBox[{"Plus", " ", "@@@", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "[", "vm", "]"}], "*", 
          RowBox[{"(", 
           RowBox[{"1", "/", "numtypes"}], ")"}]}], ")"}]}], " ", 
       "\[LessEqual]", "c"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimalAllocation", "[", 
    RowBox[{
    "ca_", ",", " ", "U_", ",", " ", "numtypes_", ",", " ", "numplaces_", ",",
      " ", 
     RowBox[{"constraintflag_:", "False"}]}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "vm", ",", " ", "obj", ",", " ", "feasibilityConstraint", ",", " ", 
       "nonzeroConstraint", ",", " ", "capacityConstraint", ",", " ", "sol", 
       ",", " ", "constraintCombinations", ",", " ", "incentiveConstraints"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", "incentiveConstraints", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "vm", " ", "is", " ", "the", " ", "allocation", " ", "array", " ", 
        "that", " ", "we", " ", "are", " ", "maximizing", " ", "over"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"vm", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{"m", ",", 
         RowBox[{"{", 
          RowBox[{"numtypes", ",", " ", "numplaces"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "obj", " ", "is", " ", "the", " ", "objective", " ", "function"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"obj", " ", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "/", "numtypes"}], ")"}], " ", "*", " ", 
        RowBox[{"Plus", " ", "@@", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"vm", " ", "U"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"feasibilityConstraint", " ", "=", " ", 
       RowBox[{"generateFeasibilityConstraints", "[", "vm", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nonzeroConstraint", " ", "=", " ", 
       RowBox[{"generateNonZeroConstraints", "[", "vm", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"capacityConstraint", " ", "=", " ", 
       RowBox[{"generateCapacityConstraints", "[", 
        RowBox[{"vm", ",", " ", "numtypes"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Incentive", " ", 
        RowBox[{"Constraint", ":", " ", 
         RowBox[{
         "Here", " ", "we", " ", "generate", " ", "all", " ", "possible", " ",
           "combinations", " ", "of", " ", "u_\[Theta]a", " ", "and", " ", 
          RowBox[{"m_\[Theta]", "'"}], "a"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"constraintCombinations", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", " ", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", " ", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"constraintCombinations", ",", 
            RowBox[{"Plus", " ", "@@", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"l", " ", 
               RowBox[{"Union", "@", 
                RowBox[{"Cases", "[", 
                 RowBox[{"obj", ",", " ", 
                  RowBox[{"m", "[", 
                   RowBox[{"i", ",", " ", "_"}], "]"}], ",", " ", 
                  "Infinity"}], "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "numtypes"}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"l", ",", " ", "U"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"constraintCombinations", " ", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{"constraintCombinations", ",", " ", "numtypes"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"incentiveConstraints", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Incentive", " ", 
        RowBox[{"Constraint", ":", " ", 
         RowBox[{
         "Generate", " ", "the", " ", "constraints", " ", "for", " ", "each", 
          " ", "\[Theta]"}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"incentiveConstraints", ",", " ", 
          RowBox[{"And", " ", "@@", " ", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"GreaterEqual", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"U", "[", 
                  RowBox[{"[", "p", "]"}], "]"}], ".", 
                 RowBox[{"vm", "[", 
                  RowBox[{"[", "p", "]"}], "]"}]}], ",", " ", "#"}], "]"}], 
              "&"}], ",", 
             RowBox[{"constraintCombinations", "[", 
              RowBox[{"[", "p", "]"}], "]"}]}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"p", ",", " ", "numtypes"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{"constraintflag", ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Objective Function: \>\"", " ", "obj"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Nonzero constraint: \>\"", "nonzeroConstraint"}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Feasibility constraint: \>\"", "feasibilityConstraint"}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Capacity constraint:\>\"", " ", "capacityConstraint"}],
           "]"}]}], ",", "0"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Printing", " ", "out", " ", "incentive", " ", "constraints", " ", 
         "takes", " ", "too", " ", "much", " ", "space"}], ",", " ", 
        RowBox[{
        "but", " ", "feel", " ", "free", " ", "to", " ", "verify", " ", 
         "them", " ", "with", " ", "the", " ", "smaller", " ", "example"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"incentiveConstraints", " ", "=", " ", 
       RowBox[{"And", " ", "@@", " ", 
        RowBox[{"Thread", " ", "[", 
         RowBox[{"Flatten", "[", "incentiveConstraints", "]"}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Evaluate", " ", "the", " ", 
        RowBox[{"function", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"sol", "=", 
       RowBox[{"FindMaximum", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"obj", ",", 
           RowBox[{
           "incentiveConstraints", " ", "&&", " ", "feasibilityConstraint", 
            " ", "&&", " ", "nonzeroConstraint", " ", "&&", " ", 
            "capacityConstraint"}]}], "}"}], ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "vm", "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"sol", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"TableForm", "[", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"sol", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "numplaces"}], "]"}], "]"}], 
       "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Approximate", " ", "the", " ", 
    RowBox[{"solution", "."}]}], "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6986054341495132`*^9, 3.69860578105742*^9}, {
   3.698605861885578*^9, 3.6986058755020723`*^9}, {3.698605988218486*^9, 
   3.698606009129202*^9}, {3.698606040299761*^9, 3.698606045002243*^9}, {
   3.699732638873374*^9, 3.699732687576126*^9}, {3.6997327706574078`*^9, 
   3.699732782890966*^9}, {3.6997328643256903`*^9, 3.699732909982027*^9}, {
   3.699733209105899*^9, 3.6997332104802923`*^9}, {3.69973413012887*^9, 
   3.699734149377447*^9}, {3.699734194907305*^9, 3.699734237594137*^9}, {
   3.699734306006907*^9, 3.69973433161554*^9}, {3.699734425105947*^9, 
   3.699734445745387*^9}, {3.699734481171063*^9, 3.699734486874865*^9}, {
   3.699734575431638*^9, 3.699734585407529*^9}, {3.699734636808676*^9, 
   3.699734662728819*^9}, {3.699734785598596*^9, 3.6997348068693237`*^9}, {
   3.69973543771417*^9, 3.6997354723325453`*^9}, {3.6997355029340277`*^9, 
   3.69973553696227*^9}, {3.699735583137051*^9, 3.699735663681808*^9}, {
   3.699735699571069*^9, 3.6997357504290333`*^9}, {3.699735806567484*^9, 
   3.69973587452067*^9}, {3.699736428819727*^9, 3.699736430026966*^9}, {
   3.699740085185028*^9, 3.6997400909049664`*^9}, {3.6997401544436483`*^9, 
   3.699740166955261*^9}, {3.699740547601194*^9, 3.6997405558555307`*^9}, {
   3.699740601722419*^9, 3.699740612737103*^9}, {3.699740747130619*^9, 
   3.699740748133597*^9}, {3.69974085209709*^9, 3.6997408799215527`*^9}, {
   3.699740916230599*^9, 3.699740953332178*^9}, {3.699741088506074*^9, 
   3.699741094265113*^9}, {3.699741135723894*^9, 3.699741140419326*^9}, {
   3.699741314082305*^9, 3.699741402433922*^9}, {3.699741436132751*^9, 
   3.699741437835433*^9}, {3.699741476790303*^9, 3.6997414776280727`*^9}, {
   3.699741512648753*^9, 3.6997415741262197`*^9}, {3.69974161781866*^9, 
   3.6997416244491653`*^9}, {3.6997417903282337`*^9, 
   3.6997417925344877`*^9}, {3.699741892603387*^9, 3.6997419123301697`*^9}, {
   3.699741994783855*^9, 3.699741998733831*^9}, {3.6997420459843063`*^9, 
   3.699742057006765*^9}, {3.699742096153639*^9, 3.6997421024643497`*^9}, {
   3.69974214435425*^9, 3.699742144889884*^9}, {3.699742226428754*^9, 
   3.69974225622101*^9}, {3.699742291919883*^9, 3.69974234281564*^9}, {
   3.6997424594290943`*^9, 3.6997424600275393`*^9}, {3.6997553435019827`*^9, 
   3.699755366635768*^9}, {3.699755429232019*^9, 3.699755438053339*^9}, {
   3.699755473406562*^9, 3.69975549409439*^9}, {3.699755531760929*^9, 
   3.699755531991084*^9}, {3.699755617105537*^9, 3.6997556352014523`*^9}, {
   3.6997558490072603`*^9, 3.699755864070503*^9}, {3.69975608489988*^9, 
   3.699756214061866*^9}, {3.6997567217297153`*^9, 3.699756853552578*^9}, {
   3.699756892778575*^9, 3.699756892961453*^9}, {3.699756968502124*^9, 
   3.699757088636819*^9}, {3.699757223164324*^9, 3.699757263399273*^9}, {
   3.6997576756027718`*^9, 3.699757733933819*^9}, {3.699757855852788*^9, 
   3.6997579612499113`*^9}, {3.69975799127569*^9, 3.699758076951296*^9}, {
   3.699758124025481*^9, 3.6997581958131742`*^9}, {3.699758268432373*^9, 
   3.69975830037782*^9}, {3.699758335947377*^9, 3.699758496218966*^9}, {
   3.699758577410255*^9, 3.6997585891441936`*^9}, {3.699758644646697*^9, 
   3.699758795722762*^9}, {3.699758846087549*^9, 3.699758857726613*^9}, {
   3.699759113876874*^9, 3.6997592513868732`*^9}, {3.6997593100465107`*^9, 
   3.6997593189590483`*^9}, {3.699759410172595*^9, 3.699759648529295*^9}, {
   3.6997596790079813`*^9, 3.699759715623151*^9}, {3.6997597556184196`*^9, 
   3.6997597840108023`*^9}, {3.699759862071808*^9, 3.6997599564917173`*^9}, {
   3.6997600632735357`*^9, 3.6997600886893272`*^9}, {3.69976018103995*^9, 
   3.699760232193555*^9}, {3.699760270930971*^9, 3.699760289761998*^9}, {
   3.699760331373547*^9, 3.699760475610057*^9}, {3.699760516204795*^9, 
   3.699760591628085*^9}, {3.699760652560055*^9, 3.69976110204112*^9}, {
   3.699761136329307*^9, 3.6997611757467403`*^9}, {3.6997612059802933`*^9, 
   3.699761209501349*^9}, {3.699761255976471*^9, 3.699761284239212*^9}, {
   3.699761316337551*^9, 3.699761411571876*^9}, {3.699761470975267*^9, 
   3.699761488526742*^9}, {3.6997615525612383`*^9, 3.69976159037955*^9}, {
   3.699761663813014*^9, 3.699762350790007*^9}, {3.699762878297469*^9, 
   3.699762898624632*^9}, {3.699763067898398*^9, 3.699763068407804*^9}, {
   3.699763143219898*^9, 3.699763168710224*^9}, {3.6997632217288847`*^9, 
   3.69976322850163*^9}, {3.699763481777403*^9, 3.699763536786045*^9}, {
   3.699764398018196*^9, 3.699764398607523*^9}, {3.699764445065072*^9, 
   3.699764450511771*^9}, {3.699795125670219*^9, 3.699795127116637*^9}, {
   3.699795392437357*^9, 3.699795465638564*^9}, {3.699795782155423*^9, 
   3.699795836362041*^9}, {3.699796254257793*^9, 3.699796276278739*^9}, {
   3.699797484734643*^9, 3.6997974878532467`*^9}, {3.699798033607667*^9, 
   3.699798034453964*^9}, {3.699798129489697*^9, 3.6997981359130487`*^9}, {
   3.699798312535818*^9, 3.699798322151366*^9}, {3.6997984601884813`*^9, 
   3.6997984989322968`*^9}, {3.699798548660833*^9, 3.699798740811747*^9}, {
   3.699798786062646*^9, 3.6997988001351013`*^9}, {3.6998190191492434`*^9, 
   3.6998192975612583`*^9}, {3.69982071815445*^9, 3.699820811972939*^9}, {
   3.699821081383231*^9, 3.6998210904137983`*^9}, {3.699821182082337*^9, 
   3.699821183481284*^9}, {3.699821258892234*^9, 3.699821262363626*^9}, {
   3.699821461972831*^9, 3.6998214632291317`*^9}, {3.6998214979099417`*^9, 
   3.699821498684298*^9}, {3.699821529525934*^9, 3.69982154198001*^9}, {
   3.6998216059831533`*^9, 3.699821615527781*^9}, {3.699821734910157*^9, 
   3.6998217352441063`*^9}, {3.699821918276215*^9, 3.699821925331835*^9}, {
   3.699823115490402*^9, 3.6998231374027433`*^9}, {3.699823204221633*^9, 
   3.699823239174765*^9}, {3.699824094854648*^9, 3.699824107143629*^9}, 
   3.699826079851386*^9, {3.699826155689003*^9, 3.699826157582467*^9}, {
   3.699826218665697*^9, 3.699826388884704*^9}, {3.69982643137807*^9, 
   3.699826440318993*^9}, {3.69982649093683*^9, 3.699826534699007*^9}, 
   3.699826565362694*^9, {3.699826677960021*^9, 3.6998267969952383`*^9}, {
   3.6998270724465933`*^9, 3.699827075843808*^9}, {3.699827133173748*^9, 
   3.69982721369499*^9}, {3.699827260490217*^9, 3.69982728734658*^9}, {
   3.699827328630412*^9, 3.699827484273575*^9}, {3.699827523604004*^9, 
   3.699827526866535*^9}, {3.6998275964130783`*^9, 3.699827628677904*^9}, {
   3.699827660832775*^9, 3.69982771809723*^9}, {3.699827824053925*^9, 
   3.6998278519902163`*^9}, {3.699827913704705*^9, 3.6998279642167473`*^9}, {
   3.699827994658814*^9, 3.699827996475775*^9}, {3.699828070693364*^9, 
   3.699828142054433*^9}, {3.699828205210387*^9, 3.699828209400477*^9}, {
   3.69982827695087*^9, 3.699828339596876*^9}, {3.699899211302744*^9, 
   3.69989932131599*^9}, {3.699899389912553*^9, 3.699899403135837*^9}, {
   3.6998995817270193`*^9, 3.699899616078874*^9}, {3.699899929219356*^9, 
   3.699899973547098*^9}, {3.699900012895138*^9, 3.699900014309037*^9}, {
   3.6999000770717487`*^9, 3.6999001128244143`*^9}, {3.699900158107757*^9, 
   3.699900652341741*^9}, {3.700052883461622*^9, 3.700052888768148*^9}, {
   3.700053029077506*^9, 3.7000530371665583`*^9}, {3.700054622731748*^9, 
   3.700054687386689*^9}, {3.7000547294931917`*^9, 3.7000547325803022`*^9}, 
   3.700054773360128*^9, 3.7000548280629597`*^9, {3.700054862480421*^9, 
   3.700054863206319*^9}, {3.700054900359624*^9, 3.7000549211765203`*^9}, {
   3.700055435586792*^9, 3.70005546694851*^9}, {3.700066495929757*^9, 
   3.7000665659751463`*^9}, {3.700066602525783*^9, 3.7000666341408167`*^9}, {
   3.7000666701510983`*^9, 3.7000666816938343`*^9}, {3.700066742705336*^9, 
   3.700066769009317*^9}, {3.700066832530902*^9, 3.7000668383356247`*^9}, {
   3.700066897196583*^9, 3.700067026365942*^9}, {3.700067082386464*^9, 
   3.7000670897287483`*^9}, {3.700067292749786*^9, 3.700067344972827*^9}, {
   3.7000675681233177`*^9, 3.700067638804077*^9}, {3.7000690666962233`*^9, 
   3.7000690827868834`*^9}, {3.700069484573159*^9, 3.700069575942131*^9}, {
   3.700070556099535*^9, 3.700070629508729*^9}, {3.7000706807142353`*^9, 
   3.700070739015976*^9}, {3.700244965593604*^9, 3.700244966180377*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", 
    RowBox[{
    "Fill", " ", "in", " ", "the", " ", "following", " ", "parameters", " ", 
     "and", " ", "run"}], "*)"}],
   FontSize->16,
   FontVariations->{"Underline"->True},
   FontColor->GrayLevel[0]], 
  StyleBox["\[IndentingNewLine]",
   FontSize->16], 
  RowBox[{"(*", 
   RowBox[{"Capacity", " ", "of", " ", "each", " ", "location", " ", "a"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"c", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Shock", " ", "on", " ", "either", " ", 
     RowBox[{"side", " ", "--"}], " ", "setting", " ", "it", " ", "equal", 
     " ", "to", " ", "1", " ", "will", " ", "generate", " ", "the", " ", 
     "following", " ", 
     RowBox[{"shocks", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", " ", "0", ",", " ", "1"}], "}"}]}]}], "*)"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kShock", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Intrinsic", " ", "quality", " ", "of", " ", "each", " ", "location", " ",
      "a"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"qSchools", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"10", ",", " ", "11", ",", " ", "12"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "generate", " ", "types", " ", "with", " ", "specified", " ", 
     "preferences", " ", "based", " ", "on", " ", "quality", " ", "of", " ", 
     "location", " ", "and", " ", "shock"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"utilities", " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"For", " ", "[", 
    RowBox[{
     RowBox[{"utilityA", " ", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qSchools", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", "kShock"}], ")"}]}], 
     ",", " ", 
     RowBox[{"utilityA", " ", "\[LessEqual]", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qSchools", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "+", "kShock"}], ")"}]}], ",", " ", 
     RowBox[{"utilityA", "++"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"utilityB", " ", "=", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qSchools", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", "kShock"}], ")"}]}],
        ",", " ", 
       RowBox[{"utilityB", " ", "\[LessEqual]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qSchools", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", "kShock"}], ")"}]}],
        ",", " ", 
       RowBox[{"utilityB", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"utilityC", " ", "=", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"qSchools", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", "-", " ", "kShock"}], 
           ")"}]}], ",", " ", 
         RowBox[{"utilityC", "\[LessEqual]", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"qSchools", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", "+", " ", "kShock"}], 
           ")"}]}], ",", " ", 
         RowBox[{"utilityC", "++"}], ",", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"utilities", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"utilityA", "/", 
              RowBox[{"(", 
               RowBox[{"utilityA", "+", "utilityB", "+", "utilityC"}], 
               ")"}]}], ",", " ", 
             RowBox[{"utilityB", "/", 
              RowBox[{"(", 
               RowBox[{"utilityA", "+", "utilityB", "+", "utilityC"}], 
               ")"}]}], ",", " ", 
             RowBox[{"utilityC", "/", 
              RowBox[{"(", 
               RowBox[{"utilityA", "+", "utilityB", "+", "utilityC"}], 
               ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Dimensions", "[", "utilities", "]"}], "\[IndentingNewLine]", 
   RowBox[{"optimalAllocation", "[", " ", 
    RowBox[{"c", ",", " ", "utilities", ",", 
     RowBox[{
      RowBox[{"Dimensions", "[", "utilities", "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "utilities", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.699736450812128*^9, 3.699736500060213*^9}, {
   3.699736579896701*^9, 3.699736775159115*^9}, {3.6997368064245157`*^9, 
   3.699736875480215*^9}, 3.699736906243012*^9, {3.699736997206725*^9, 
   3.699737118424556*^9}, {3.6997371789324007`*^9, 3.699737249022769*^9}, {
   3.699737297032216*^9, 3.699737301859893*^9}, 3.699737359181778*^9, {
   3.699737391475169*^9, 3.699737399977882*^9}, {3.699737492502427*^9, 
   3.699737595128129*^9}, {3.699737688387802*^9, 3.699737688738995*^9}, {
   3.699737824679628*^9, 3.699737843433652*^9}, {3.699738057760993*^9, 
   3.699738341320225*^9}, {3.6997384595188313`*^9, 3.699738503366016*^9}, {
   3.699738534689209*^9, 3.699738538350769*^9}, {3.699738590754538*^9, 
   3.699738627345729*^9}, {3.6997386739864883`*^9, 3.699738675428898*^9}, {
   3.69973938498839*^9, 3.6997395297747498`*^9}, {3.699739586450622*^9, 
   3.699739603737226*^9}, {3.699739647181032*^9, 3.699739674747231*^9}, {
   3.699739716175644*^9, 3.699739869450266*^9}, {3.699739900906865*^9, 
   3.699739913513988*^9}, {3.699740526912137*^9, 3.699740537606223*^9}, {
   3.699741304352559*^9, 3.699741305120338*^9}, {3.699742352512862*^9, 
   3.699742368175027*^9}, {3.699742404507207*^9, 3.699742414617202*^9}, {
   3.699762525852756*^9, 3.699762555667995*^9}, {3.699762589592375*^9, 
   3.6997626798167152`*^9}, {3.699762751538931*^9, 3.699762812900856*^9}, {
   3.699762937013129*^9, 3.699763019636539*^9}, {3.6997635892657747`*^9, 
   3.699763599241783*^9}, {3.699763701365406*^9, 3.699763746214596*^9}, {
   3.699763790039775*^9, 3.699763795839081*^9}, {3.6997638397578287`*^9, 
   3.699763938004855*^9}, {3.69976431568403*^9, 3.69976434355811*^9}, {
   3.69976455798622*^9, 3.6997645591102667`*^9}, 3.699794583406893*^9, {
   3.699794626562236*^9, 3.699794644050353*^9}, {3.699794691941268*^9, 
   3.699794699813592*^9}, {3.699797922936308*^9, 3.699797923201312*^9}, {
   3.699821959481923*^9, 3.6998219693704348`*^9}, {3.6998232517593327`*^9, 
   3.6998232636122828`*^9}, {3.699826835548151*^9, 3.699826957654565*^9}, {
   3.699828392642948*^9, 3.699828417613906*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   StyleBox["(*",
    FontSize->16], 
   RowBox[{
    StyleBox[
     RowBox[{"Easy", " ", "example", " ", "for", " ", "2", " ", "types"}],
     FontSize->16], 
    StyleBox[",",
     FontSize->16], 
    StyleBox[" ",
     FontSize->16], 
    RowBox[{
     StyleBox["3",
      FontSize->16], 
     StyleBox[" ",
      FontSize->16], 
     StyleBox["locations",
      FontSize->16], "\[IndentingNewLine]", "Set", " ", "the", " ", 
     "capacity", " ", "of", " ", "the", " ", "places"}], ",", " ", 
    RowBox[{
    "set", " ", "the", " ", "utility", " ", "function", " ", "by", " ", 
     "hand"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"c", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0.5", ",", "0.5", ",", " ", "0.5"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"U", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"3", "/", "7"}], ",", " ", 
         RowBox[{"3", "/", "7"}], ",", " ", 
         RowBox[{"1", "/", "7"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.11", ",", " ", "0.12", ",", " ", "0.13"}], "}"}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Parameters", " ", "are"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"optimalAllocation", "[", 
    RowBox[{"c", ",", " ", "U", ",", " ", "2", ",", " ", "3"}], "]"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.69860590092734*^9, 3.698605936982141*^9}, {
   3.6997343409199047`*^9, 3.6997343424534807`*^9}, {3.699734474274611*^9, 
   3.699734478529653*^9}, {3.699734598422763*^9, 3.699734599165656*^9}, {
   3.699735544302637*^9, 3.699735555054644*^9}, {3.6997356171216507`*^9, 
   3.6997356174392*^9}, {3.69973566586592*^9, 3.699735683321664*^9}, {
   3.6997357272432613`*^9, 3.699735738475281*^9}, {3.699735822879898*^9, 
   3.699735826006345*^9}, {3.699736409276538*^9, 3.699736421602735*^9}, {
   3.699739867673674*^9, 3.6997398920336*^9}, 3.699741298472534*^9, 
   3.699741369321039*^9, {3.6997421280272293`*^9, 3.699742130583901*^9}, {
   3.69974217029827*^9, 3.699742200588312*^9}, {3.6997423334730186`*^9, 
   3.699742340806761*^9}, 3.699755202979041*^9, 3.699755336356943*^9, {
   3.699755613698324*^9, 3.6997556157758427`*^9}, {3.699757157313883*^9, 
   3.699757161534169*^9}, {3.699762359251246*^9, 3.6997623604769497`*^9}, {
   3.699762408080151*^9, 3.699762469639978*^9}, {3.6997627326734877`*^9, 
   3.699762744826004*^9}, {3.69976324114044*^9, 3.699763271565289*^9}, 
   3.699763545778698*^9, {3.6997635775138617`*^9, 3.699763578048327*^9}, {
   3.6998209843437233`*^9, 3.699821015784996*^9}, {3.699821104554685*^9, 
   3.699821155910116*^9}, {3.699821194957974*^9, 3.699821230872259*^9}, {
   3.6998213886857147`*^9, 3.69982139466945*^9}, {3.6998231768744783`*^9, 
   3.699823182218082*^9}, {3.700054794027739*^9, 3.7000547977306023`*^9}, {
   3.7000548674638968`*^9, 3.700054867947682*^9}, {3.700055417517336*^9, 
   3.700055450283762*^9}, {3.700066308019614*^9, 3.700066308627688*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.7000613171317997`*^9, 3.700066969073118*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{808, 623},
WindowMargins->{{236, Automatic}, {Automatic, 50}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 95, 1, 92, "Title"],
Cell[CellGroupData[{
Cell[700, 27, 106, 1, 64, "Section"],
Cell[809, 30, 17265, 328, 1314, "Input"],
Cell[18077, 360, 6731, 148, 390, "Input"],
Cell[24811, 510, 3092, 68, 159, "Input"],
Cell[27906, 580, 92, 1, 32, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

